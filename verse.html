<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VERSE SFT Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="background-img"></div>
    <div class="container">
        <nav>
            <a href="index.html" class="nav-btn">Materials</a>
            <a href="ballast.html" class="nav-btn">Ballast</a>
            <a href="curve.html" class="nav-btn">Curve Elevation</a>
            <a href="destress.html" class="nav-btn">Destress</a>
            <a href="verse.html" class="nav-btn active">VERSE</a>
        </nav>
        <div class="header">
            <button class="info-btn" onclick="showInfo()">ℹ️</button>
        </div>
        <div class="input-row">
            <input type="text" id="length" placeholder="Unclipped length (m)">
            <input type="text" id="sag" placeholder="Measured sag (mm)">
            <input type="text" id="temp" placeholder="Rail temp TR (°C)">
            <button class="calc-btn" onclick="calculate()">Calculate</button>
        </div>
        <div class="results" id="results">
            <div class="result-item" id="output"></div>
        </div>
        <div class="bottom-row">
            <button class="copy-btn" onclick="copyResults()" id="copyBtn">Copy</button>
        </div>
    </div>
    <!-- Info Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('infoModal')">&times;</span>
            <h2>Info</h2>
            <p>Estimates Stress Free Temperature (SFT) using a rough approximation of the VERSE method by measuring rail sag under self-weight.<br>Inputs: Unclipped length L (m, default 33 for >60kg rails), measured sag δ (mm, downward deflection at center), rail temp TR (°C).<br>Formulas:<br>w = m * g (self-weight load N/m, m=68kg/m, g=9.81)<br>δ0 = 5 w L⁴ / (384 E I) (no-axial deflection m)<br>Pcr = π² E I / L² (Euler buckling N)<br>k = δ0 / δ (δ in m)<br>If δ > δ0 (compression): P = Pcr (1 - k) (compression +)<br>If δ < δ0 (tension): P = -Pcr (k - 1) (tension -)<br>ΔT = P / (A E α)<br>SFT = TR - ΔT<br>Deviation = SFT - 37°C (DSFT).<br>Constants: E=210 GPa, α=1.15e-5 /°C, for 68kg/m: A=0.00868 m², I=3.89e-5 m⁴.<br>Note: Rough beam theory approximation for manual sag measurement; actual VERSE uses force for fixed lift and proprietary calibration. For tension/compression; assumes simply supported, self-weight only.</p>
        </div>
    </div>
    <script>
        let resultsCopied = false;
        function showInfo() {
            document.getElementById('infoModal').style.display = 'block';
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        function calculate() {
            const L = parseFloat(document.getElementById('length').value);
            const sag_mm = parseFloat(document.getElementById('sag').value);
            const TR = parseFloat(document.getElementById('temp').value);
            if (isNaN(L) || isNaN(sag_mm) || isNaN(TR)) return;
            const delta = sag_mm / 1000; // m
            const m = 68; // kg/m
            const g = 9.81; // m/s²
            const w = m * g; // N/m
            const E = 210e9; // Pa
            const I = 3.89e-5; // m⁴
            const A = 0.00868; // m²
            const alpha = 1.15e-5; // /°C
            const delta0 = (5 * w * Math.pow(L, 4)) / (384 * E * I); // m
            const Pcr = Math.PI * Math.PI * E * I / (L * L); // N
            const k = delta0 / delta;
            let P = 0;
            if (delta > delta0) { // compression
                P = Pcr * (1 - k);
            } else { // tension
                P = -Pcr (k - 1);
            }
            const deltaT = P / (A * E * alpha);
            const SFT = TR - deltaT;
            const DSFT = 37;
            const deviation = SFT - DSFT;
            const output = `Estimated SFT: ${SFT.toFixed(1)} °C<br>Deviation from DSFT: ${deviation.toFixed(1)} °C`;
            document.getElementById('output').innerHTML = output;
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').classList.add('show');
            resultsCopied = false;
            document.getElementById('copyBtn').classList.remove('disabled');
        }
        function copyResults() {
            if (resultsCopied) return;
            const resultsDiv = document.getElementById('results');
            let text = '';
            for (let child of resultsDiv.children) {
                text += child.innerText + '\n';
            }
            navigator.clipboard.writeText(text);
            resultsCopied = true;
            document.getElementById('copyBtn').classList.add('disabled');
        }
    </script>
</body>
</html>
