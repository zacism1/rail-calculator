<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rail Calculators</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            position: relative;
            overflow-y: auto;
        }
        .background-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('newrail.png'); /* Replace with actual image URL or base64 */
            background-size: cover;
            opacity: 0.5;
            z-index: -1;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 10px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .quote-btn {
            background-color: orange;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
        }
        .info-btn {
            background: none;
            border: none;
            font-size: 22px;
            color: blue;
            cursor: pointer;
        }
        .input-row {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        input[type="text"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-right: 10px;
            margin-bottom: 10px;
            min-width: 200px;
        }
        .calc-btn, .copy-btn, .spacing-btn {
            background-color: blue;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-left: 10px;
            margin-bottom: 10px;
        }
        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .results {
            display: none;
        }
        .result-item {
            margin-bottom: 10px;
        }
        .icon {
            width: 25px;
            height: 25px;
            margin-left: 10px;
        }
        .bottom-row {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover {
            color: black;
            cursor: pointer;
        }
        .decline-btn {
            background-color: red;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .agree-btn {
            background-color: green;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        /* Tab styles */
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #ddd;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background: white;
            border-bottom: none;
        }
        .panel {
            display: none;
        }
        .panel.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="background-img"></div>
    <main class="container">
        <nav class="tabs" role="tablist">
            <button class="tab active" data-target="materials">Materials</button>
            <button class="tab" data-target="ballast">Ballast Calculator</button>
            <button class="tab" data-target="curve">Curve Elevation</button>
            <button class="tab" data-target="destress">Destress</button>
        </nav>

        <!-- Materials Panel -->
        <section id="materials" class="panel active" role="tabpanel">
            <div class="header">
                <button class="quote-btn" onclick="showQuote()">Quote of the week</button>
                <button class="info-btn" onclick="showInfo('materials')">ℹ️</button>
            </div>
            <div class="input-row">
                <input type="text" id="distance-materials" placeholder="Distance of track (in meters)">
                <button class="calc-btn" onclick="calculateMaterials()" id="calcBtn-materials">Calculate</button>
            </div>
            <div class="results" id="results-materials">
                <div class="result-item" id="sleepers-materials"></div>
                <div class="result-item" id="packs16-materials"></div>
                <div class="result-item" id="packs8-materials"></div>
                <div class="result-item" id="packs6-materials"></div>
                <div class="result-item" id="clips-materials"></div>
                <div class="result-item" id="insulators-materials"></div>
                <div class="result-item" id="insulators-details-materials"></div>
                <div class="result-item" id="pads-materials"></div>
                <div class="result-item" id="rail-lengths-materials"></div>
                <div class="result-item" id="rail-weight-68-materials"></div>
                <div class="result-item" id="rail-weight-60-materials"></div>
                <div class="result-item" id="rail-weight-50-materials"></div>
            </div>
            <div class="bottom-row">
                <button class="spacing-btn" onclick="cycleSpacing('materials')">600mm</button>
                <button class="copy-btn" onclick="copyResults('materials')" id="copyBtn-materials">Copy</button>
            </div>
        </section>

        <!-- Ballast Panel -->
        <section id="ballast" class="panel" role="tabpanel">
            <div class="header">
                <button class="quote-btn" onclick="showQuote()">Quote of the week</button>
                <button class="info-btn" onclick="showInfo('ballast')">ℹ️</button>
            </div>
            <div class="input-row">
                <input type="text" id="distance-ballast" placeholder="Distance of track (in meters)">
                <input type="text" id="depth" value="300" placeholder="Ballast depth (mm)">
                <input type="text" id="shoulder" value="300" placeholder="Ballast shoulder width (mm)">
                <button class="calc-btn" onclick="calculateBallast()" id="calcBtn-ballast">Calculate</button>
            </div>
            <div class="results" id="results-ballast">
                <div class="result-item" id="ballast-output"></div>
            </div>
            <div class="bottom-row">
                <button class="spacing-btn" onclick="cycleSpacing('ballast')">600mm</button>
                <button class="copy-btn" onclick="copyResults('ballast')" id="copyBtn-ballast">Copy</button>
            </div>
        </section>

        <!-- Curve Elevation Panel -->
        <section id="curve" class="panel" role="tabpanel">
            <h2>Curve Elevation</h2>
            <p>Curve elevation calculator coming soon.</p>
        </section>

        <!-- Destress Panel -->
        <section id="destress" class="panel" role="tabpanel">
            <h2>Destress</h2>
            <p>Destress calculator coming soon.</p>
        </section>
    </main>

    <!-- Shared Modals -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('termsModal')">&times;</span>
            <h2>Terms of Service</h2>
            <!-- Terms text here (same as before) -->
            <p>Last updated: [15-06-2023]</p>
            <!-- ... full terms omitted for brevity, copy from previous -->
            <button class="decline-btn" onclick="declineTerms()">Decline</button>
            <button class="agree-btn" onclick="agreeTerms()">Agree</button>
        </div>
    </div>
    <div id="quoteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('quoteModal')">&times;</span>
            <h2>Quote of the Week</h2>
            <p id="quoteText"></p>
        </div>
    </div>
    <div id="infoModal-materials" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('infoModal-materials')">&times;</span>
            <h2>Info</h2>
            <p>Press the 600mm button to toggle between spacing options, 600, 650, 670, 675, 700. Scrap steel weight does not account for head loss and assumes both legs of the track are being replaced.</p>
        </div>
    </div>
    <div id="infoModal-ballast" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('infoModal-ballast')">&times;</span>
            <h2>Info</h2>
            <p>The ballast quantity might be slightly inaccurate depending on the specific requirements of the track section. Press the 600mm button to toggle between spacing options, 600, 650, 670, 675, 700.</p>
        </div>
    </div>

    <script>
        const quotes = [ /* same quotes array as before */ ];
        const sleeperSpacingOptions = [0.6, 0.65, 0.670, 0.675, 0.7];
        let selectedSleeperSpacingIndexMaterials = 0;
        let selectedSleeperSpacingIndexBallast = 0;
        let agreedToTerms = localStorage.getItem('agreedToTerms') === 'true';
        let resultsCopiedMaterials = false;
        let resultsCopiedBallast = false;

        // Init quote (same as before)
        const weekOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 1)) / (24 * 60 * 60 * 1000 * 7));
        const quoteIndex = weekOfYear % quotes.length;
        document.getElementById('quoteText').innerText = quotes[quoteIndex];

        // Show terms if not agreed (same as before)
        if (!agreedToTerms) {
            document.getElementById('termsModal').style.display = 'block';
            document.querySelectorAll('.calc-btn').forEach(btn => btn.classList.add('disabled'));
        }

        function agreeTerms() {
            agreedToTerms = true;
            localStorage.setItem('agreedToTerms', 'true');
            closeModal('termsModal');
            document.querySelectorAll('.calc-btn').forEach(btn => btn.classList.remove('disabled'));
        }

        function declineTerms() {
            document.body.innerHTML = '<h1>Terms Declined</h1>';
        }

        function showQuote() {
            document.getElementById('quoteModal').style.display = 'block';
        }

        function showInfo(tab) {
            document.getElementById(`infoModal-${tab}`).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.target).classList.add('active');
            });
        });

        function cycleSpacing(tab) {
            if (tab === 'materials') {
                selectedSleeperSpacingIndexMaterials = (selectedSleeperSpacingIndexMaterials + 1) % sleeperSpacingOptions.length;
                document.querySelector('#materials .spacing-btn').innerText = `${Math.round(sleeperSpacingOptions[selectedSleeperSpacingIndexMaterials] * 1000)}mm`;
                if (document.getElementById('distance-materials').value) calculateMaterials();
            } else if (tab === 'ballast') {
                selectedSleeperSpacingIndexBallast = (selectedSleeperSpacingIndexBallast + 1) % sleeperSpacingOptions.length;
                document.querySelector('#ballast .spacing-btn').innerText = `${Math.round(sleeperSpacingOptions[selectedSleeperSpacingIndexBallast] * 1000)}mm`;
                if (document.getElementById('distance-ballast').value) calculateBallast();
            }
        }

        function calculateMaterials() {
            if (!agreedToTerms) return;
            const distance = parseFloat(document.getElementById('distance-materials').value);
            if (isNaN(distance)) return;
            const spacing = sleeperSpacingOptions[selectedSleeperSpacingIndexMaterials];
            const numberOfSleepers = distance / spacing;
            // ... full materials calc logic here (same as previous materials page, e.g., packs, clips, insulators, pads, rail lengths, weights)
            // Update DOM elements like document.getElementById('sleepers-materials').innerText = ...
            // (Omitted for brevity; copy from previous JS)
            document.getElementById('results-materials').style.display = 'block';
            resultsCopiedMaterials = false;
            document.getElementById('copyBtn-materials').classList.remove('disabled');
        }

        function calculateBallast() {
            if (!agreedToTerms) return;
            const distance = parseFloat(document.getElementById('distance-ballast').value);
            const depth_m = parseFloat(document.getElementById('depth').value) / 1000;
            const shoulder_m = parseFloat(document.getElementById('shoulder').value) / 1000;
            if (isNaN(distance) || isNaN(depth_m) || isNaN(shoulder_m)) return;
            const spacing = sleeperSpacingOptions[selectedSleeperSpacingIndexBallast];
            // ... full ballast calc logic here (same as previous ballast page)
            // Update document.getElementById('ballast-output').innerHTML = ...
            document.getElementById('results-ballast').style.display = 'block';
            resultsCopiedBallast = false;
            document.getElementById('copyBtn-ballast').classList.remove('disabled');
        }

        function copyResults(tab) {
            // ... copy logic per tab, similar to previous
        }
    </script>
</body>
</html>
