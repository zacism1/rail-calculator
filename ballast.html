<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ballast Calculator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="background-img"></div>
    <div class="container">
        <nav>
            <a href="index.html" class="nav-btn">Materials</a>
            <a href="ballast.html" class="nav-btn active">Ballast</a>
            <a href="curve.html" class="nav-btn">Curve Elevation</a>
            <a href="destress.html" class="nav-btn">Destress</a>
            <a href="verse.html" class="nav-btn">VERSE</a>
        </nav>
        <div class="header">
            <button class="info-btn" onclick="showInfo()">ℹ️</button>
        </div>
        <div class="input-row">
            <input type="text" id="distance" placeholder="Distance of track (in meters)">
            <input type="text" id="depth" placeholder="Ballast depth (mm)">
            <input type="text" id="shoulder" placeholder="Ballast shoulder (mm)">
            <button class="calc-btn" onclick="calculate()">Calculate</button>
        </div>
        <div class="results" id="results">
            <div class="result-item" id="ballast"></div>
        </div>
        <div class="bottom-row">
            <button class="spacing-btn" onclick="cycleSpacing()">600mm</button>
            <button class="copy-btn" onclick="copyResults()" id="copyBtn">Copy</button>
        </div>
    </div>
    <!-- Info Modal -->
    <div id="infoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('infoModal')">&times;</span>
            <h2>Info</h2>
            <p>The model is a trapezoidal prism with 1:1.5 slope (as per CoP). Top width = sleeper length (2.55m) + 2 * shoulder. Bottom width = top + 2 * 1.5 * height. Height = depth + sleeper height (0.24m). Subtract total sleeper volume (each 2.55x0.24x0.24m). Use spacing toggle for number of sleepers. Density 1.55 t/m³ compacted. Assumes no crib ballast deduction or other losses.</p>
        </div>
    </div>
    <script>
        const sleeperSpacingOptions = [0.6, 0.65, 0.670, 0.675, 0.7];
        let selectedSleeperSpacingIndex = 0;
        let resultsCopied = false;
        function showInfo() {
            document.getElementById('infoModal').style.display = 'block';
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        function cycleSpacing() {
            selectedSleeperSpacingIndex = (selectedSleeperSpacingIndex + 1) % sleeperSpacingOptions.length;
            const btn = document.querySelector('.spacing-btn');
            btn.innerText = `${Math.round(sleeperSpacingOptions[selectedSleeperSpacingIndex] * 1000)}mm`;
            if (document.getElementById('distance').value) {
                calculate();
            }
        }
        function calculate() {
            const distanceStr = document.getElementById('distance').value;
            const depthStr = document.getElementById('depth').value;
            const shoulderStr = document.getElementById('shoulder').value;
            const distance = parseFloat(distanceStr);
            const depth_m = parseFloat(depthStr) / 1000;
            const shoulder_m = parseFloat(shoulderStr) / 1000;
            if (isNaN(distance) || isNaN(depth_m) || isNaN(shoulder_m)) return;
            const spacing = sleeperSpacingOptions[selectedSleeperSpacingIndex];
            const sleeper_length_m = 2.55;
            const sleeper_width_m = 0.24;
            const sleeper_height_m = 0.24;
            const total_height_m = depth_m + sleeper_height_m;
            const top_width_m = sleeper_length_m + 2 * shoulder_m;
            const slope_factor = 1.5;
            const bottom_width_m = top_width_m + 2 * slope_factor * total_height_m;
            const cross_area = ((top_width_m + bottom_width_m) / 2) * total_height_m;
            const total_vol = distance * cross_area;
            const sleeper_vol_single = sleeper_length_m * sleeper_width_m * sleeper_height_m;
            const num_sleepers = distance / spacing;
            const total_sleeper_vol = num_sleepers * sleeper_vol_single;
            const net_vol = Math.max(0, total_vol - total_sleeper_vol);
            const density = 1.55; // Typical compacted railway ballast t/m³
            const weight = net_vol * density;
            // Display results
            document.getElementById('ballast').innerHTML = `*Ballast Volume (Roughly): ${net_vol.toFixed(2)} cubic meters | Weight (approx): ${weight.toFixed(2)} tonnes (at 1.55 t/m³)`;
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').classList.add('show');
            resultsCopied = false;
            document.getElementById('copyBtn').classList.remove('disabled');
        }
        function copyResults() {
            if (resultsCopied) return;
            const resultsDiv = document.getElementById('results');
            let text = '';
            for (let child of resultsDiv.children) {
                text += child.innerText + '\n';
            }
            navigator.clipboard.writeText(text);
            resultsCopied = true;
            document.getElementById('copyBtn').classList.add('disabled');
        }
    </script>
</body>
</html>
